<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Analysis - 10&nbsp; Data Wrangling with {dplyr}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./11-module.html" rel="next">
<link href="./09-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>


<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-module.html">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></a></li><li class="breadcrumb-item"><a href="./10-module.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling with {dplyr}</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./img/statistics-hand.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling with {dplyr}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Central Tendency and Spread</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">10.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">10.2</span> Preliminaries</a></li>
  <li><a href="#data-wrangling-using-dplyr" id="toc-data-wrangling-using-dplyr" class="nav-link" data-scroll-target="#data-wrangling-using-dplyr"><span class="header-section-number">10.3</span> Data Wrangling Using {dplyr}</a>
  <ul class="collapse">
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter()</code></a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><code>select()</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><code>arrange()</code></a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename"><code>rename()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><code>mutate()</code></a></li>
  <li><a href="#summarize-and-group_by" id="toc-summarize-and-group_by" class="nav-link" data-scroll-target="#summarize-and-group_by"><code>summarize()</code> and <code>group_by()</code></a></li>
  </ul></li>
  <li><a href="#other-useful-dplyr-functions" id="toc-other-useful-dplyr-functions" class="nav-link" data-scroll-target="#other-useful-dplyr-functions"><span class="header-section-number">10.4</span> Other Useful {dplyr} Functions</a></li>
  <li><a href="#joining-tables" id="toc-joining-tables" class="nav-link" data-scroll-target="#joining-tables"><span class="header-section-number">10.5</span> Joining Tables</a>
  <ul class="collapse">
  <li><a href="#inner-joins" id="toc-inner-joins" class="nav-link" data-scroll-target="#inner-joins">Inner Joins</a></li>
  <li><a href="#outer-joins" id="toc-outer-joins" class="nav-link" data-scroll-target="#outer-joins">Outer Joins</a></li>
  <li><a href="#other-joins" id="toc-other-joins" class="nav-link" data-scroll-target="#other-joins">Other Joins</a></li>
  </ul></li>
  <li><a href="#chaining-and-piping" id="toc-chaining-and-piping" class="nav-link" data-scroll-target="#chaining-and-piping"><span class="header-section-number">10.6</span> Chaining and Piping</a>
  <ul class="collapse">
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE:</a></li>
  </ul></li>
  <li><a href="#dot-syntax-and-the-pipe" id="toc-dot-syntax-and-the-pipe" class="nav-link" data-scroll-target="#dot-syntax-and-the-pipe"><span class="header-section-number">10.7</span> Dot Syntax and the Pipe</a></li>
  <li><a href="#useful-related-packages" id="toc-useful-related-packages" class="nav-link" data-scroll-target="#useful-related-packages"><span class="header-section-number">10.8</span> Useful Related Packages</a></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="module-10" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling with {dplyr}</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objectives" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">10.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>The objective of this module to introduce you to data wrangling using the {dplyr} package, which is part of the {tidyverse} family.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">10.2</span> Preliminaries</h2>
<ul>
<li>Install (but do not load yet) this package in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/tidylog/tidylog.pdf">{tidylog}</a></li>
<li>Install and load this package: <a href="https://cran.r-project.org/web/packages/magrittr/magrittr.pdf">{magrittr}</a></li>
<li>Load {tidyverse}</li>
<li>Load in the KamilarAndCooper dataset we used in <a href="09-module.html"><strong>Module 09</strong></a> as a “tibble” named <strong>d</strong></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-2022-datasets/main/KamilarAndCooperData.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)  <span class="co"># creates a 'tibble'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 44
##   Scientific_Name             Family        Genus Species Brain_Size_Species_M…¹
##   &lt;chr&gt;                       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;
## 1 Allenopithecus_nigroviridis Cercopitheci… Alle… nigrov…                   58.0
## 2 Allocebus_trichotis         Cercopitheci… Allo… tricho…                   NA  
## 3 Alouatta_belzebul           Atelidae      Alou… belzeb…                   52.8
## 4 Alouatta_caraya             Atelidae      Alou… caraya                    52.6
## 5 Alouatta_guariba            Atelidae      Alou… guariba                   51.7
## 6 Alouatta_palliata           Atelidae      Alou… pallia…                   49.9
## # ℹ abbreviated name: ¹​Brain_Size_Species_Mean
## # ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
## #   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
## #   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
## #   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
## #   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
## #   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="data-wrangling-using-dplyr" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="data-wrangling-using-dplyr"><span class="header-section-number">10.3</span> Data Wrangling Using {dplyr}</h2>
<p>The {dplyr} package, included in the {tidyverse}, provides “a flexible grammar of data manipulation” that makes many of the manipulations that we explore in <a href="07-module.html"><strong>Module 07</strong></a> and <a href="09-module.html"><strong>Module 09</strong></a> much easier and muchmore intuitive!</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/dplyr.png" class="img-fluid figure-img" style="width:25.0%"></p>
</figure>
</div>
</div>
</div>
<p>Among other functions, {dplyr} introduces a set of <em>verbs</em> (<code>filter()</code>, <code>select()</code>, <code>arrange()</code>, <code>rename()</code>, <code>mutate()</code>, <code>summarize()</code>, and <code>group_by()</code>) that can be used to perform useful operations on “tibbles” and related tabular data structures (e.g., normal data frames and data tables). Before using {dplyr} for summarizing data and producing aggregate statistics, let’s look in general at what we can do with these verbs…</p>
<section id="filter" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="filter"><code>filter()</code></h3>
<p>The <code>filter()</code> function lets us pull out rows from a data frame that meet a particular criterion or set of criteria:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/filter.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Baumer et al.&nbsp;(2017). <em>Modern Data Science with R.</em> Chapman and Hall/CRC.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting rows..</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Family <span class="sc">==</span> <span class="st">"Hominidae"</span> <span class="sc">&amp;</span> Mass_Dimorphism <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 3 × 44
##   Scientific_Name Family    Genus   Species  Brain_Size_Species_Mean
##   &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;                      &lt;dbl&gt;
## 1 Gorilla_gorilla Hominidae Gorilla gorilla                     490.
## 2 Pongo_abelii    Hominidae Pongo   abelii                      390.
## 3 Pongo_pygmaeus  Hominidae Pongo   pygmaeus                    377.
## # ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
## #   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
## #   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
## #   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
## #   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
## #   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;,
## #   Life_History_Ref &lt;chr&gt;, GR_MidRangeLat_dd &lt;dbl&gt;, Precip_Mean_mm &lt;dbl&gt;, …</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> The first argument of any of the {dplyr} verbs is the <code>.data</code> argument. That is the line of code above is equivalent to <code>s &lt;- filter(.data = d, Family == "Hominidae" &amp; Mass_Dimorphism &gt; 2)</code></p>
</blockquote>
</section>
<section id="select" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="select"><code>select()</code></h3>
<p>The <code>select()</code> function lets us pull out only particular columns from a data frame:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/select.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Baumer et al.&nbsp;(2017). <em>Modern Data Science with R.</em> Chapman and Hall/CRC.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># selecting specific columns...</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">select</span>(d, Family, Genus, Body_mass_male_mean)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 3
##   Family          Genus          Body_mass_male_mean
##   &lt;chr&gt;           &lt;chr&gt;                        &lt;dbl&gt;
## 1 Cercopithecidae Allenopithecus                6130
## 2 Cercopithecidae Allocebus                       92
## 3 Atelidae        Alouatta                      7270
## 4 Atelidae        Alouatta                      6525
## 5 Atelidae        Alouatta                      5800
## 6 Atelidae        Alouatta                      7150</code></pre>
</div>
</div>
</section>
<section id="arrange" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="arrange"><code>arrange()</code></h3>
<p>The <code>arrange()</code> function lets us sort a data frame based on a select variable or set of variables:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/arrange.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Baumer et al.&nbsp;(2017). <em>Modern Data Science with R.</em> Chapman and Hall/CRC.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reordering a data frame by a set of variables...</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">arrange</span>(d, Family, Genus, Body_mass_male_mean)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 44
##   Scientific_Name    Family   Genus    Species   Brain_Size_Species_Mean
##   &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                       &lt;dbl&gt;
## 1 Alouatta_guariba   Atelidae Alouatta guariba                      51.7
## 2 Alouatta_caraya    Atelidae Alouatta caraya                       52.6
## 3 Alouatta_seniculus Atelidae Alouatta seniculus                    55.2
## 4 Alouatta_palliata  Atelidae Alouatta palliata                     49.9
## 5 Alouatta_belzebul  Atelidae Alouatta belzebul                     52.8
## 6 Alouatta_pigra     Atelidae Alouatta pigra                        51.1
## # ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
## #   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
## #   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
## #   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
## #   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
## #   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;,
## #   Life_History_Ref &lt;chr&gt;, GR_MidRangeLat_dd &lt;dbl&gt;, Precip_Mean_mm &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>We can also specify the direction in which we want the data frame to be sorted:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `desc()` can be used to reverse the order</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">arrange</span>(d, <span class="fu">desc</span>(Family), Genus, Species, <span class="fu">desc</span>(Body_mass_male_mean))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 44
##   Scientific_Name         Family      Genus      Species  Brain_Size_Species_M…¹
##   &lt;chr&gt;                   &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;                     &lt;dbl&gt;
## 1 Tarsius_bancanus        Tarsiidae   Tarsius    bancanus                   3.16
## 2 Tarsius_dentatus        Tarsiidae   Tarsius    dentatus                  NA   
## 3 Tarsius_syrichta        Tarsiidae   Tarsius    syrichta                   3.36
## 4 Cacajao_calvus          Pitheciidae Cacajao    calvus                    76   
## 5 Cacajao_melanocephalus  Pitheciidae Cacajao    melanoc…                  68.8 
## 6 Callicebus_donacophilus Pitheciidae Callicebus donacop…                  NA   
## # ℹ abbreviated name: ¹​Brain_Size_Species_Mean
## # ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
## #   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
## #   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
## #   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
## #   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
## #   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="rename" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="rename"><code>rename()</code></h3>
<p>The <code>rename()</code> function allows us to change the names of particular columns in a data frame:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming columns...</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">rename</span>(d, <span class="at">Female_Mass =</span> Body_mass_female_mean)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s<span class="sc">$</span>Female_Mass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 3180   84 5520 4240 4550 5350</code></pre>
</div>
</div>
</section>
<section id="mutate" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="mutate"><code>mutate()</code></h3>
<p>The <code>mutate()</code> function allows us to add new columns to a data frame:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/mutate.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Baumer et al.&nbsp;(2017). <em>Modern Data Science with R.</em> Chapman and Hall/CRC.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and adding new columns...</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">Binomial =</span> <span class="fu">paste</span>(Genus, Species, <span class="at">sep =</span> <span class="st">" "</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s<span class="sc">$</span>Binomial)  <span class="co"># or head(s[['Binomial']])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "Allenopithecus nigroviridis" "Allocebus trichotis"        
## [3] "Alouatta belzebul"           "Alouatta caraya"            
## [5] "Alouatta guariba"            "Alouatta palliata"</code></pre>
</div>
</div>
</section>
<section id="summarize-and-group_by" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="summarize-and-group_by"><code>summarize()</code> and <code>group_by()</code></h3>
<p>The {dplyr} package makes it easy to summarize data using more convenient functions than the {base} function <code>aggregate()</code>, which we looked at in <a href="09-module.html"><strong>Module 09</strong></a>. The <code>summarize()</code> function specifies a list of summary variables that will appear in the output, along with the operations that will be performed on vectors in the data frame to produce those summary variables:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/summarize.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Baumer et al.&nbsp;(2017). <em>Modern Data Science with R.</em> Chapman and Hall/CRC.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">summarize</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  d,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_cases =</span> <span class="fu">n</span>(),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the n() function from {dplyr} returns the number of rows in the data frame</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">avgF =</span> <span class="fu">mean</span>(Body_mass_female_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">avgM =</span> <span class="fu">mean</span>(Body_mass_male_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 3
##   n_cases  avgF  avgM
##     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     213 5396. 8112.</code></pre>
</div>
</div>
<p>Additionally, the <code>group_by()</code> function allows us to construct these summary variables for sets of observations defined by a particular categorical variable, as we did above with <code>aggregate()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>byFamily <span class="ot">&lt;-</span> <span class="fu">group_by</span>(d, Family)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">summarise</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  byFamily,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_cases =</span> <span class="fu">n</span>(),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here, n() returns the number of rows in the group being considered</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">avgF =</span> <span class="fu">mean</span>(Body_mass_female_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">avgM =</span> <span class="fu">mean</span>(Body_mass_male_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 14 × 4
##    Family          n_cases   avgF   avgM
##    &lt;chr&gt;             &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 Atelidae             12  6616.  7895.
##  2 Cebidae              37   876.  1012.
##  3 Cercopithecidae      79  6328.  9543.
##  4 Cheirogalidae         7   186.   193.
##  5 Daubentonidae         1  2490   2620 
##  6 Galagidae             7   372.   395.
##  7 Hominidae             6 53444. 98681.
##  8 Hylobatidae          11  6682.  6926.
##  9 Indriidae             9  3887.  3638.
## 10 Lemuridae            17  1991.  2077.
## 11 Lepilemuridae         6   814.   792 
## 12 Lorisidae             8   490.   512.
## 13 Pitheciidae          10  1768.  1955.
## 14 Tarsiidae             3   120    131</code></pre>
</div>
</div>
</section>
</section>
<section id="other-useful-dplyr-functions" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="other-useful-dplyr-functions"><span class="header-section-number">10.4</span> Other Useful {dplyr} Functions</h2>
<ul>
<li><code>ungroup()</code> - clears group metadata from a table put in place <code>group_by()</code></li>
<li><code>bind_rows()</code> and <code>bind_cols()</code> - adds rows and columns, respectively, to a dataframe or tibble; when binding rows, if the column names do not match, the column will still be added and missing values filled with <code>NA</code>; when binding columns, the number of rows in each dataframe needs to be the same</li>
<li><code>pull()</code> - pulls a single variable out of a dataframe as a vector</li>
<li><code>sample_n()</code> - randomly samples a set of “size=” rows from a dataframe with (“replace=TRUE”) or without (“replace=FALSE”) replacement; this function is being superceded in favor of <code>slice_sample()</code>, where an additional argument (<code>n=</code> or <code>prop=</code>) allows you to specify the number or proportion of rows, respectively, to sample randomly</li>
<li><code>drop_na()</code> - drops rows from a dataframe that have <code>NA</code> values for any variable names passed as arguments to the function</li>
<li><code>rowwise()</code> - allows you to explicitly perform functions on a data frame on a row-at-a-time basis, which is useful if a vectorized function does not exit</li>
</ul>
<p>A full list of {dplyr} functions and their descriptions is available <a href="https://dplyr.tidyverse.org/reference/index.html">here</a>.</p>
</section>
<section id="joining-tables" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="joining-tables"><span class="header-section-number">10.5</span> Joining Tables</h2>
<p>One of the other major forms of data wrangling that we often need to do is to <strong>combine</strong> variables from different tabular data structures into a new table. This process is often referred to as performing a “mutating join” or simply a “join”.</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> For those with experience with other database systems, it is related to the “JOIN” commands in SQL.</p>
</blockquote>
<p>The process works by matching observations in two different tables by a common key variable and then selecting additional variables of interest to pull from each of the tables. A simple example is the following… suppose we have two tables, one that contains average brain sizes for particular species of primates and one that contains individual body sizes for some of the same species, plus others. In the latter table, too, we may have data from multiple individuals of the same species represented.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>table1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Taxon =</span> <span class="fu">c</span>(<span class="st">"Gorilla"</span>, <span class="st">"Human"</span>, <span class="st">"Chimpanzee"</span>, <span class="st">"Orangutan"</span>, <span class="st">"Baboon"</span>),</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Avg_Brain_Size =</span> <span class="fu">c</span>(<span class="dv">470</span>, <span class="dv">1100</span>, <span class="dv">350</span>, <span class="dv">340</span>, <span class="dv">140</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>table1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 5 × 2
##   Taxon      Avg_Brain_Size
##   &lt;chr&gt;               &lt;dbl&gt;
## 1 Gorilla               470
## 2 Human                1100
## 3 Chimpanzee            350
## 4 Orangutan             340
## 5 Baboon                140</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>table2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Taxon =</span> <span class="fu">c</span>(<span class="st">"Gorilla"</span>, <span class="st">"Gorilla"</span>, <span class="st">"Gorilla"</span>, <span class="st">"Human"</span>, <span class="st">"Human"</span>, <span class="st">"Chimpanzee"</span>,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Orangutan"</span>, <span class="st">"Orangutan"</span>, <span class="st">"Macaque"</span>, <span class="st">"Macaque"</span>, <span class="st">"Macaque"</span>), <span class="at">Body_Weight =</span> <span class="fu">c</span>(<span class="dv">80</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">81</span>, <span class="dv">77</span>, <span class="dv">48</span>, <span class="dv">49</span>, <span class="dv">38</span>, <span class="dv">37</span>, <span class="dv">36</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">6</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 11 × 2
##    Taxon      Body_Weight
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Gorilla             80
##  2 Gorilla             81
##  3 Gorilla             77
##  4 Human               48
##  5 Human               49
##  6 Chimpanzee          38
##  7 Orangutan           37
##  8 Orangutan           36
##  9 Macaque              6
## 10 Macaque              7
## 11 Macaque              6</code></pre>
</div>
</div>
<section id="inner-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="inner-joins">Inner Joins</h3>
<p>An <em>inner join</em> or <em>equijoin</em> matches up sets of observations between two tables whenever their keys are equal. The output of an inner join is a new data frame that contains all rows from the left-hand (<em>x</em>) and right-hand (<em>y</em>) tables where there are matching values in the key column, plus all columns from <em>x</em> and <em>y</em>. If there are multiple matches between the tables, all combination of the matches are returned. This is represented schematically below:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/inner_join.png" class="img-fluid figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Wickham &amp; Grolemund (2017). <em>R for Data Science.</em> O’Reilly Media, Inc.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 8 × 3
##   Taxon      Avg_Brain_Size Body_Weight
##   &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
## 1 Gorilla               470          80
## 2 Gorilla               470          81
## 3 Gorilla               470          77
## 4 Human                1100          48
## 5 Human                1100          49
## 6 Chimpanzee            350          38
## 7 Orangutan             340          37
## 8 Orangutan             340          36</code></pre>
</div>
</div>
</section>
<section id="outer-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="outer-joins">Outer Joins</h3>
<p>While an inner join keeps only observations that appear in both tables, different flavors of <em>outer joins</em> keep observations that appear in at least one of the tables. There are three types of outer joins:</p>
<ul>
<li>A <em>left join</em> returns all rows from the left-hand table, <strong>x</strong>, and all columns from <strong>x</strong> and <strong>y</strong>. Rows in <strong>x</strong> with no match in <strong>y</strong> will have <code>NA</code> values in the new columns from the <strong>y</strong> table. If there are multiple matches between <strong>x</strong> and *<strong>y</strong>, all combinations of the matches are returned.</li>
<li>A <em>right join</em> returns all rows from the right-hand table, <strong>y</strong>, and all columns from <strong>x</strong> and <strong>y</strong>. Rows in <strong>y</strong> with no match in <strong>x</strong> will have <code>NA</code> values in the new columns from the <strong>x</strong> table. If there are multiple matches between <strong>x</strong> and <strong>y</strong>, all combinations of the matches are returned.</li>
<li>A <em>full join</em> returns all rows and all columns in both the left-hand (<strong>x</strong>) and right-hand (<strong>y</strong>) tables, joining them where there are matches. Where there are not matching values, the join returns <code>NA</code> for the columns from table where they are missing.</li>
</ul>
<p>The following figure shows a schematic representation of these various types of outer joins:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/outer_joins.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<div style="color:#787878; font-size: 14px;">
<center>
<p>FROM: Wickham &amp; Grolemund (2017). <em>R for Data Science.</em> O’Reilly Media, Inc.</p>
</center>
<p><br></p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 9 × 3
##   Taxon      Avg_Brain_Size Body_Weight
##   &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
## 1 Gorilla               470          80
## 2 Gorilla               470          81
## 3 Gorilla               470          77
## 4 Human                1100          48
## 5 Human                1100          49
## 6 Chimpanzee            350          38
## 7 Orangutan             340          37
## 8 Orangutan             340          36
## 9 Baboon                140          NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">right_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 11 × 3
##    Taxon      Avg_Brain_Size Body_Weight
##    &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
##  1 Gorilla               470          80
##  2 Gorilla               470          81
##  3 Gorilla               470          77
##  4 Human                1100          48
##  5 Human                1100          49
##  6 Chimpanzee            350          38
##  7 Orangutan             340          37
##  8 Orangutan             340          36
##  9 Macaque                NA           6
## 10 Macaque                NA           7
## 11 Macaque                NA           6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 12 × 3
##    Taxon      Avg_Brain_Size Body_Weight
##    &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
##  1 Gorilla               470          80
##  2 Gorilla               470          81
##  3 Gorilla               470          77
##  4 Human                1100          48
##  5 Human                1100          49
##  6 Chimpanzee            350          38
##  7 Orangutan             340          37
##  8 Orangutan             340          36
##  9 Baboon                140          NA
## 10 Macaque                NA           6
## 11 Macaque                NA           7
## 12 Macaque                NA           6</code></pre>
</div>
</div>
</section>
<section id="other-joins" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="other-joins">Other Joins</h3>
<p>There are also two additional join types that may be sometimes be useful… note that these joins only return columns from the left-hand table, <strong>x</strong>.</p>
<ul>
<li>A <em>semi_join</em> returns rows from the left-hand table, <strong>x</strong>, where there are matching values in <strong>y</strong>, but keeping just the columns from <strong>x</strong>. A <em>semi_join</em> differs from an <em>inner_join</em> because an <em>inner_join</em> will return a row of <em>x</em> for every matching row of <strong>y</strong> (so some <strong>x</strong> rows can be duplicated), whereas a <em>semi_join</em> will never duplicate rows of <strong>x</strong>.</li>
<li>An <em>anti_join</em> returns all rows from the left-hand table,<strong>x</strong> where there are not matching values in <strong>y</strong>, keeping just the columns from <strong>x</strong>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">semi_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 4 × 2
##   Taxon      Avg_Brain_Size
##   &lt;chr&gt;               &lt;dbl&gt;
## 1 Gorilla               470
## 2 Human                1100
## 3 Chimpanzee            350
## 4 Orangutan             340</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anti_join</span>(table1, table2, <span class="at">by =</span> <span class="st">"Taxon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 2
##   Taxon  Avg_Brain_Size
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 Baboon            140</code></pre>
</div>
</div>
<p>The cheatsheet on <a href="cheatsheets/data-transformation.pdf">Data Transformation with {dplyr}</a> provides a nice overview of these and additional data wrangling functions included the {dplyr} package.</p>
</section>
</section>
<section id="chaining-and-piping" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="chaining-and-piping"><span class="header-section-number">10.6</span> Chaining and Piping</h2>
<p>One other cool thing about the {dplyr} package is that it provides a convenient way to chain together operations on a data frame using the “forward pipe” operator (<code>%&gt;%</code>). The <code>%&gt;%</code> operator basically takes what is on the left-hand side (LHS) of the operator and directly applies the function call on the right-hand side (RHS) of the operator to it. That is, it “pipes” what is on the LHS of the operator directly to the first argument of the function on the right. This process allows us to build of chains of successive operations, each one being applied to the outcome of the previous operation in the chain.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/pipe.png" class="img-fluid figure-img" style="width:25.0%"></p>
</figure>
</div>
</div>
</div>
<div class="fold s o">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/MagrittePipe.jpg" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
</div>
<p><strong>EXAMPLE:</strong></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this...</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Scientific_Name, Body_mass_female_mean) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 2
##   Scientific_Name             Body_mass_female_mean
##   &lt;chr&gt;                                       &lt;dbl&gt;
## 1 Allenopithecus_nigroviridis                  3180
## 2 Allocebus_trichotis                            84
## 3 Alouatta_belzebul                            5520
## 4 Alouatta_caraya                              4240
## 5 Alouatta_guariba                             4550
## 6 Alouatta_palliata                            5350</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># is equivalent to...</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(d, Scientific_Name, Body_mass_female_mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 2
##   Scientific_Name             Body_mass_female_mean
##   &lt;chr&gt;                                       &lt;dbl&gt;
## 1 Allenopithecus_nigroviridis                  3180
## 2 Allocebus_trichotis                            84
## 3 Alouatta_belzebul                            5520
## 4 Alouatta_caraya                              4240
## 5 Alouatta_guariba                             4550
## 6 Alouatta_palliata                            5350</code></pre>
</div>
</div>
<p>The forward pipe is useful because it allows us to write and follow code from left to right (as when writing in English), instead of right to left with many nested parentheses.</p>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE:</h3>
<ul>
<li><p>In <strong>one line of code</strong>, do the following:</p>
<ul>
<li>Add a variable, <strong>Binomial</strong> to our data frame <strong>d</strong>, which is a concatenation of the <strong>Genus</strong> and <strong>Species</strong>…</li>
<li>Trim the data frame to only include the variables <strong>Binomial</strong>, <strong>Family</strong>, <strong>Body_mass_female_mean</strong>, <strong>Body_mass_male_mean</strong> and <strong>Mass_Dimorphism</strong>…</li>
<li>Group these variables by <strong>Family</strong>…</li>
<li>Calculate the average value for female body mass, male body mass, and mass dimorphism (remember, you will need to specify <code>na.rm = TRUE</code>…)</li>
<li>And arrange by <em>decreasing</em> average mass dimorphism.</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">Binomial =</span> <span class="fu">paste</span>(Genus, Species, <span class="at">sep =</span> <span class="st">" "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Binomial, Family, Body_mass_female_mean, Body_mass_male_mean, Mass_Dimorphism) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Family) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">avgF =</span> <span class="fu">mean</span>(Body_mass_female_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">avgM =</span> <span class="fu">mean</span>(Body_mass_male_mean,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">avgBMD =</span> <span class="fu">mean</span>(Mass_Dimorphism, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(avgBMD))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 14 × 4
##    Family            avgF   avgM avgBMD
##    &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 Hominidae       53444. 98681.  1.81 
##  2 Cercopithecidae  6328.  9543.  1.49 
##  3 Atelidae         6616.  7895.  1.23 
##  4 Tarsiidae         120    131   1.09 
##  5 Pitheciidae      1768.  1955.  1.09 
##  6 Cebidae           876.  1012.  1.07 
##  7 Lemuridae        1991.  2077.  1.06 
##  8 Daubentonidae    2490   2620   1.05 
##  9 Lorisidae         490.   512.  1.05 
## 10 Galagidae         372.   395.  1.05 
## 11 Hylobatidae      6682.  6926.  1.03 
## 12 Cheirogalidae     186.   193.  1.02 
## 13 Lepilemuridae     814.   792   0.980
## 14 Indriidae        3887.  3638.  0.950</code></pre>
</div>
</div>
<p>There are several other, very cool, “special case” pipe operators that are useful in particular situations. These are available from the {magrittr} package. [Actually, the functionality of the forward pipe operator also comes from the {magrittr} package, but it is replicated in {dplyr}.]</p>
<ul>
<li>The “tee” pipe (<code>%T&gt;%</code>) allows you to pipe the outcome of a process into a new expression (just like the forward pipe operator does) <em>and</em> to simultaneously return the original value instead of the forward-piped result to an intermediate expression. This is useful, for example, for printing out or plotting intermediate results. In the example below, we filter our data frame for just observations of the genus <em>Alouatta</em>, print those to the screen as an intermediate side effect, and pass the filtered data to the <code>summarise()</code> function.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>) <span class="sc">%T&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">avgF =</span> <span class="fu">mean</span>(Body_mass_female_mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 44
##   Scientific_Name    Family   Genus    Species   Brain_Size_Species_Mean
##   &lt;chr&gt;              &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                       &lt;dbl&gt;
## 1 Alouatta_belzebul  Atelidae Alouatta belzebul                     52.8
## 2 Alouatta_caraya    Atelidae Alouatta caraya                       52.6
## 3 Alouatta_guariba   Atelidae Alouatta guariba                      51.7
## 4 Alouatta_palliata  Atelidae Alouatta palliata                     49.9
## 5 Alouatta_pigra     Atelidae Alouatta pigra                        51.1
## 6 Alouatta_seniculus Atelidae Alouatta seniculus                    55.2
## # ℹ 39 more variables: Brain_Size_Female_Mean &lt;dbl&gt;, Brain_size_Ref &lt;chr&gt;,
## #   Body_mass_male_mean &lt;dbl&gt;, Body_mass_female_mean &lt;dbl&gt;,
## #   Mass_Dimorphism &lt;dbl&gt;, Mass_Ref &lt;chr&gt;, MeanGroupSize &lt;dbl&gt;,
## #   AdultMales &lt;dbl&gt;, AdultFemale &lt;dbl&gt;, AdultSexRatio &lt;dbl&gt;,
## #   Social_Organization_Ref &lt;chr&gt;, InterbirthInterval_d &lt;dbl&gt;, Gestation &lt;dbl&gt;,
## #   WeaningAge_d &lt;dbl&gt;, MaxLongevity_m &lt;dbl&gt;, LitterSz &lt;dbl&gt;,
## #   Life_History_Ref &lt;chr&gt;, GR_MidRangeLat_dd &lt;dbl&gt;, Precip_Mean_mm &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 1
##    avgF
##   &lt;dbl&gt;
## 1 5217.</code></pre>
</div>
</div>
<ul>
<li>The “assignment” pipe (<code>%&lt;&gt;%</code>) evaluates the expression on the right-hand side of the pipe operator and reassigns the resultant value to the left-hand side.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&lt;&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Genus, Species)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 2
##   Genus    Species  
##   &lt;chr&gt;    &lt;chr&gt;    
## 1 Alouatta belzebul 
## 2 Alouatta caraya   
## 3 Alouatta guariba  
## 4 Alouatta palliata 
## 5 Alouatta pigra    
## 6 Alouatta seniculus</code></pre>
</div>
</div>
<ul>
<li>Finally, the “exposition” pipe (<code>%$%</code>) exposes the names <em>within</em> the object on the left-hand side of the pipe to the right-hand side expression.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>) <span class="sc">%$%</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(Genus, <span class="st">" "</span>, Species)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "Alouatta belzebul"  "Alouatta caraya"    "Alouatta guariba"  
## [4] "Alouatta palliata"  "Alouatta pigra"     "Alouatta seniculus"</code></pre>
</div>
</div>
</section>
</section>
<section id="dot-syntax-and-the-pipe" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="dot-syntax-and-the-pipe"><span class="header-section-number">10.7</span> Dot Syntax and the Pipe</h2>
<p>Normally, when we use the forward pipe operator, the LHS of the operator is passed to the first argument of the function on the RHS. Thus, the following are all equivalent:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Genus <span class="sc">==</span> <span class="st">"Alouatta"</span>) <span class="ot">-&gt;</span> s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The behavior of the forward pipe operator means we can use it do something like the following, where <strong>d</strong> is implicitly piped into the <code>data</code> argument for <code>ggplot()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(Body_mass_female_mean), <span class="at">y =</span> <span class="fu">log</span>(Brain_Size_Species_Mean))) <span class="sc">+</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: Removed 42 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also use dot (<code>.</code>) syntax with the {magrittr} forward pipe operator to pass the LHS of a statement to somewhere other than the first argument of the function on the RHS. Thus…</p>
<p><code>y %&gt;% function(x, .)</code> is equivalent to <code>function(x, y)</code></p>
<p>… which means we can do something like this to pipe <strong>d</strong> into a function such as <code>lm()</code> (“linear model”), where the data frame that the function is run on is not the first argument:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(<span class="fu">log</span>(Body_mass_female_mean) <span class="sc">~</span> <span class="fu">log</span>(Brain_Size_Species_Mean), <span class="at">data =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = log(Body_mass_female_mean) ~ log(Brain_Size_Species_Mean), 
##     data = .)
## 
## Coefficients:
##                  (Intercept)  log(Brain_Size_Species_Mean)  
##                        3.713                         1.135</code></pre>
</div>
</div>
<p>We can also use the {magrittr} pipe’s curly brace (<code>{}</code>) syntax to wrap the RHS of a statement and pass the LHS into several places:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(<span class="fu">log</span>(.<span class="sc">$</span>Brain_Size_Species_Mean), <span class="fu">log</span>(.<span class="sc">$</span>Body_mass_female_mean))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="output/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> <strong><em>R</em></strong> recently introduced a “native” pipe operator <code>|&gt;</code> into its {base} syntax. It behaves very similarly to the {magrittr} forward pipe, but does not support dot syntax the same way. It also requires an explicit functions call on the RHS, which means appending <code>()</code> to the end of the function name, rather than just using the name. The first version of the line below using <code>%&gt;%</code> could be used to take the log of all <strong>Brain_Size_Female_Mean</strong> values in <strong>d</strong>, while the second version, using <code>|&gt;</code>, needs to have <code>()</code> appended to the functions calls to work properly.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Brain_Size_Female_Mean) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    log <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 1
##   Brain_Size_Female_Mean
##                    &lt;dbl&gt;
## 1                   3.98
## 2                  NA   
## 3                   3.94
## 4                   3.87
## 5                   3.89
## 6                   3.87</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Brain_Size_Female_Mean) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>() <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 1
##   Brain_Size_Female_Mean
##                    &lt;dbl&gt;
## 1                   3.98
## 2                  NA   
## 3                   3.94
## 4                   3.87
## 5                   3.89
## 6                   3.87</code></pre>
</div>
</div>
</section>
<section id="useful-related-packages" class="level2" data-number="10.8">
<h2 data-number="10.8" class="anchored" data-anchor-id="useful-related-packages"><span class="header-section-number">10.8</span> Useful Related Packages</h2>
<p>The {tidylog} package provides wrappers around many {dplyr} and {tidyr} package functions that provide logged feedback on the outcome of those functions, which can be useful for understanding the effects of whatever data wrangling processes we run. For example, running <code>filter()</code> will provide feedback on the number of runs removed and kept as part of a filtering operation…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## Attaching package: 'tidylog'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## The following objects are masked from 'package:dplyr':
## 
##     add_count, add_tally, anti_join, count, distinct, distinct_all,
##     distinct_at, distinct_if, filter, filter_all, filter_at, filter_if,
##     full_join, group_by, group_by_all, group_by_at, group_by_if,
##     inner_join, left_join, mutate, mutate_all, mutate_at, mutate_if,
##     relocate, rename, rename_all, rename_at, rename_if, rename_with,
##     right_join, sample_frac, sample_n, select, select_all, select_at,
##     select_if, semi_join, slice, slice_head, slice_max, slice_min,
##     slice_sample, slice_tail, summarise, summarise_all, summarise_at,
##     summarise_if, summarize, summarize_all, summarize_at, summarize_if,
##     tally, top_frac, top_n, transmute, transmute_all, transmute_at,
##     transmute_if, ungroup</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## The following objects are masked from 'package:tidyr':
## 
##     drop_na, fill, gather, pivot_longer, pivot_wider, replace_na,
##     spread, uncount</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## The following object is masked from 'package:stats':
## 
##     filter</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare...</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(d, Family <span class="sc">==</span> <span class="st">"Hominidae"</span> <span class="sc">&amp;</span> Mass_Dimorphism <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to...</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">filter</span>(d, Family <span class="sc">==</span> <span class="st">"Hominidae"</span> <span class="sc">&amp;</span> Mass_Dimorphism <span class="sc">&gt;</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## filter: removed 210 rows (99%), 3 rows remaining</code></pre>
</div>
</div>
<p>Similarly, running <code>sample_n()</code> will give us logged output on that random record sampling process…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare...</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">sample_n</span>(d, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to...</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">sample_n</span>(d, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## sample_n: removed 113 rows (53%), 100 rows remaining</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>tidylog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Loading in {tidylog} function will conflict with or “mask” corresponding function names from {dplyr} and {tidyr}. In the examples above, then, to run the {tidyverse} versions of <code>filter()</code> and <code>select_n()</code>, it was necessary to use the <code>::</code> notation to specifically call the {dplyr} version of the functions directly. The {tidylog} versions of these functions run a bit more slowly, so if speed is important, you may not want to use {tidylog}, you may want to call the {dplyr} or {tidyr} functions explicitly after loading {tidylog}, or you may want to simply call the {tidylog} version of a function explicitly.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> tidylog<span class="sc">::</span><span class="fu">filter</span>(d, Family <span class="sc">==</span> <span class="st">"Hominidae"</span> <span class="sc">&amp;</span> Mass_Dimorphism <span class="sc">&gt;</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## filter: removed 210 rows (99%), 3 rows remaining</code></pre>
</div>
</div>
<hr>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li>Using {dplyr}: <code>select()</code>, <code>filter()</code>, <code>arrange()</code>, <code>rename()</code>, <code>mutate()</code>, <code>summarise()</code>, <code>group_by()</code></li>
<li>Chaining and piping with <code>%&gt;%</code> and other pipe operators</li>
<li>Joining tables: <code>inner_join()</code>, <code>left_join()</code>, <code>right_join()</code>, <code>full_join()</code></li>
<li>Using the {tidylog} package</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./09-module.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./11-module.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>